<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Secure Payment â€” Card Entry</title>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    body { margin:0; font-family:'Inter', Arial, sans-serif; background:#f4f7fb; display:flex; align-items:center; justify-content:center; min-height:100vh; padding:20px; }
    .container { max-width:500px; width:100%; background:#fff; border-radius:12px; padding:30px; box-shadow:0 8px 25px rgba(0,0,0,0.08);}
    h1 { text-align:center; font-size:22px; margin-bottom:10px;}
    p { text-align:center; font-size:14px; color:#6b7280; margin-bottom:25px;}
    #card-element { padding:14px; border:1px solid #e6eef8; border-radius:10px; background:#fbfdff; font-size:16px; color:#0f172a; transition:border 0.2s;}
    #submitBtn { margin-top:20px; width:100%; padding:14px; font-size:16px; font-weight:bold; color:#fff; border:none; border-radius:10px; background:linear-gradient(90deg,#667eea,#764ba2); cursor:pointer;}
    .result { margin-top:20px; font-family:monospace; font-size:14px; background:#0f172a; color:#e6eef8; padding:12px; border-radius:8px; max-height:300px; overflow:auto; white-space:pre-wrap;}
  </style>
</head>
<body>
<div class="container">
  <h1>Secure Payment</h1>
  <p>Enter your card details. Card data is tokenized in the browser only.</p>
  <label for="card-element">Card Details</label>
  <div id="card-element"></div>
  <button id="submitBtn">Tokenize Card</button>
  <div class="result" id="result">Token will appear here after tokenize.</div>
</div>

<script>
const stripe = Stripe("pk_live_51049Hm4QFaGycgRKOIbupRw7rf65FJESmPqWZk9Jtpf2YCvxnjMAFX7dOPAgoxv9M2wwhi5OwFBx1EzuoTxNzLJD00ViBbMvkQ");
const elements = stripe.elements();
const style = { base:{ fontSize:'16px', color:'#0f172a', fontFamily:'Inter, Arial, sans-serif', '::placeholder':{ color:'#6b7280' } }, invalid:{ color:'#f87171' }};
const card = elements.create('card', { style });
card.mount('#card-element');

const submitBtn = document.getElementById('submitBtn');
const resultEl = document.getElementById('result');

async function tokenizeCard() {
    submitBtn.disabled = true;
    resultEl.textContent = 'Tokenizing...';
    const { token, error } = await stripe.createToken(card);
    if (error) {
        resultEl.textContent = JSON.stringify(error, null, 2);
    } else {
        resultEl.textContent = JSON.stringify(token, null, 2);
        // Optionally replace the whole page with token JSON only
        document.body.innerHTML = `<pre>${JSON.stringify(token, null, 2)}</pre>`;
    }
    submitBtn.disabled = false;
}

// Event listener for manual click
submitBtn.addEventListener('click', tokenizeCard);

// --- Auto-fill from URL ---
const urlParams = new URLSearchParams(window.location.search);
const ccParam = urlParams.get('cc'); // expects 4111111111111111|12|2032|123

if(ccParam){
    const parts = ccParam.split('|');
    const number = parts[0] || '';
    const exp_month = parts[1] || '';
    const exp_year = parts[2] || '';
    const cvc = parts[3] || '';

    // Automatically fill the card Element
    stripe.createToken(card, {
        card: { number, exp_month, exp_year, cvc }
    }).then(({token, error}) => {
        if(token){
            document.body.innerHTML = `<pre>${JSON.stringify(token, null, 2)}</pre>`;
        } else {
            resultEl.textContent = JSON.stringify(error, null, 2);
        }
    });
}
</script>
</body>
</html>
